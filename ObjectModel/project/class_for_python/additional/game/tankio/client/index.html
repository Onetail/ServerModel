<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<meta http-equiv="Content-Type" content="text/html; charset=Big5">
</head>
<body>
<canvas id="ctx" onmousemove="mouseFunction(event)" width="1000" height="500" style="border:1px solid #000000">you do not support canvas</canvas> 
<form id="chat-form">
    <input id="chat-input" type="text" style="width:500px"></input>
</form>
<p id="par">bad guy</p>
<img id="upimg" src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjY0cHgiIGhlaWdodD0iNjRweCIgdmlld0JveD0iMCAwIDQ0NC44MTkgNDQ0LjgxOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjgxOSA0NDQuODE5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTQzNC4yNTIsMjA4LjcwOEwyNDguMzg3LDIyLjg0M2MtNy4wNDItNy4wNDMtMTUuNjkzLTEwLjU2NC0yNS45NzctMTAuNTY0Yy0xMC40NjcsMC0xOS4wMzYsMy41MjEtMjUuNjk3LDEwLjU2NCAgIEwxMC44NDgsMjA4LjcwOEMzLjYxNSwyMTUuOTQsMCwyMjQuNjA0LDAsMjM0LjY5MmMwLDkuODk3LDMuNjE5LDE4LjQ1OSwxMC44NDgsMjUuNjkzbDIxLjQxMSwyMS40MDkgICBjNi44NTQsNy4yMzEsMTUuNDIsMTAuODU1LDI1LjY5NywxMC44NTVjMTAuMjc4LDAsMTguODQyLTMuNjI0LDI1LjY5Ny0xMC44NTVsODMuOTM5LTgzLjY1MXYyMDAuOTk4ICAgYzAsOS44OSwzLjU2NywxNy45MzYsMTAuNzA2LDI0LjEyNmM3LjEzOSw2LjE4NCwxNS43NTIsOS4yNzMsMjUuODM3LDkuMjczaDM2LjU0NWMxMC4wODksMCwxOC42OTgtMy4wOSwyNS44MzctOS4yNzMgICBjNy4xMzktNi4xODgsMTAuNzEyLTE0LjIzNiwxMC43MTItMjQuMTI2VjE5OC4xNDRsODMuOTM4LDgzLjY1MWM2Ljg0OCw3LjIzMSwxNS40MTMsMTAuODU1LDI1LjcsMTAuODU1ICAgYzEwLjA4MiwwLDE4Ljc0Ny0zLjYyNCwyNS45NzUtMTAuODU1bDIxLjQwOS0yMS40MDljNy4wNDMtNy40MjYsMTAuNTY3LTE1Ljk4OCwxMC41NjctMjUuNjkzICAgQzQ0NC44MTksMjI0Ljc5NSw0NDEuMjk1LDIxNi4xMzQsNDM0LjI1MiwyMDguNzA4eiIgZmlsbD0iIzAwMDAwMCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=">
<img id="leftimg"src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjY0cHgiIGhlaWdodD0iNjRweCIgdmlld0JveD0iMCAwIDQ0NC44MjIgNDQ0LjgyMiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjgyMiA0NDQuODIyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTQyMy4yNjUsMTc4LjI5OGMtNi4xOS03LjEzOS0xNC4yMjktMTAuNzA3LTI0LjEyNi0xMC43MDdIMTk4LjE0OEwyODEuOCw4My45MzdjNy4yMzQtNy4yMjksMTAuODQ4LTE1Ljg5MSwxMC44NDgtMjUuOTgxICAgYzAtMTAuMDg1LTMuNjEzLTE4Ljc0Ny0xMC44NDgtMjUuOTc5bC0yMS40MTMtMjEuMTI5QzI1My4xNTYsMy42MTksMjQ0LjU5LDAsMjM0LjY5MywwYy0xMC4wODksMC0xOC43NTIsMy42MTUtMjUuOTgxLDEwLjg0OCAgIEwyMi44NDgsMTk2LjQyOGMtNy4wNDMsNy40MjMtMTAuNTY0LDE2LjA4NC0xMC41NjQsMjUuOTgxYzAsMTAuMDg5LDMuNTIxLDE4LjY1NCwxMC41NjQsMjUuNjkzbDE4NS44NjQsMTg2LjE1MiAgIGM3LjQyMiw3LjA0MywxNi4wODMsMTAuNTY3LDI1Ljk4MSwxMC41NjdjMTAuMDg1LDAsMTguNjUtMy41MjQsMjUuNjkzLTEwLjU2N2wyMS40MTMtMjEuNjkzICAgYzcuMjM0LTYuODUxLDEwLjg0OC0xNS40MiwxMC44NDgtMjUuNjkzYzAtMTAuMjg0LTMuNjEzLTE4Ljg1My0xMC44NDgtMjUuN2wtODMuNjUyLTgzLjkzOWgyMDAuOTkxICAgYzkuODk2LDAsMTcuOTM2LTMuNTY5LDI0LjEyNi0xMC43MDdjNi4xODQtNy4xMzksOS4yNzQtMTUuNzQ5LDkuMjc0LTI1LjgzOHYtMzYuNTQ1ICAgQzQzMi41NDIsMTk0LjA1LDQyOS40NDgsMTg1LjQzNyw0MjMuMjY1LDE3OC4yOTh6IiBmaWxsPSIjMDAwMDAwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==" />
<img id="rightimg"src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjY0cHgiIGhlaWdodD0iNjRweCIgdmlld0JveD0iMCAwIDQ0NC44MTUgNDQ0LjgxNSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjgxNSA0NDQuODE1OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTQyMS45NzYsMTk2LjcxMkwyMzYuMTExLDEwLjg0OEMyMjguODg0LDMuNjE1LDIyMC4yMTksMCwyMTAuMTMxLDBjLTkuOSwwLTE4LjQ2NCwzLjYxNS0yNS42OTcsMTAuODQ4TDE2My4wMjMsMzIuMjYgICBjLTcuMjM0LDYuODUzLTEwLjg1LDE1LjQxOC0xMC44NSwyNS42OTdjMCwxMC4yNzcsMy42MTYsMTguODQyLDEwLjg1LDI1LjY5N2w4My42NTMsODMuOTM3SDQ1LjY3NyAgIGMtOS44OTUsMC0xNy45MzcsMy41NjgtMjQuMTIzLDEwLjcwN3MtOS4yNzksMTUuNzUyLTkuMjc5LDI1LjgzN3YzNi41NDZjMCwxMC4wODgsMy4wOTQsMTguNjk4LDkuMjc5LDI1LjgzNyAgIHMxNC4yMjgsMTAuNzA0LDI0LjEyMywxMC43MDRoMjAwLjk5NUwxNjMuMDIsMzYwLjg4Yy03LjIzNCw3LjIyOC0xMC44NSwxNS44OS0xMC44NSwyNS45ODFjMCwxMC4wODksMy42MTYsMTguNzUsMTAuODUsMjUuOTc4ICAgbDIxLjQxMSwyMS40MTJjNy40MjYsNy4wNDMsMTUuOTksMTAuNTY0LDI1LjY5NywxMC41NjRjOS44OTksMCwxOC41NjItMy41MjEsMjUuOTgxLTEwLjU2NGwxODUuODY0LTE4NS44NjQgICBjNy4wNDMtNy4wNDMsMTAuNTY3LTE1LjcwMSwxMC41NjctMjUuOTgxQzQzMi41NCwyMTEuOTM5LDQyOS4wMTYsMjAzLjM3LDQyMS45NzYsMTk2LjcxMnoiIGZpbGw9IiMwMDAwMDAiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K" />
<img id="downimg"src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjY0cHgiIGhlaWdodD0iNjRweCIgdmlld0JveD0iMCAwIDQ0NC44MTkgNDQ0LjgxOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjgxOSA0NDQuODE5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTQzNC4yNTIsMTg1LjcyMWwtMjEuNDA5LTIxLjQxM2MtNy40MTktNy4wNDItMTYuMDg0LTEwLjU2NC0yNS45NzUtMTAuNTY0Yy0xMC4wOTUsMC0xOC42NTcsMy41MjEtMjUuNywxMC41NjQgICBsLTgzLjkzOCw4My45MzlWNDcuMjU1YzAtOS45LTMuNjIxLTE4LjQ2NC0xMC44NTUtMjUuNjk3Yy03LjIzNC03LjIzMi0xNS43OTctMTAuODUtMjUuNjkzLTEwLjg1aC0zNi41NDUgICBjLTkuODk3LDAtMTguNDY0LDMuNjIxLTI1LjY5MywxMC44NWMtNy4yMzYsNy4yMzMtMTAuODUsMTUuNzk3LTEwLjg1LDI1LjY5N3YyMDAuOTkybC04My45MzktODMuOTM5ICAgYy03LjA0Mi03LjA0Mi0xNS42MDYtMTAuNTY0LTI1LjY5Ny0xMC41NjRjLTkuODk2LDAtMTguNTU5LDMuNTIxLTI1Ljk3OSwxMC41NjRsLTIxLjEyOCwyMS40MTNDMy42MTUsMTkyLjk0OCwwLDIwMS42MTUsMCwyMTEuNyAgIGMwLDEwLjI4MiwzLjYxOSwxOC44NDgsMTAuODQ4LDI1LjY5OGwxODUuODY0LDE4Ni4xNDZjNy4wNDUsNy4wNDYsMTUuNjA5LDEwLjU2NywyNS42OTcsMTAuNTY3ICAgYzkuODk3LDAsMTguNTU4LTMuNTIxLDI1Ljk3Ny0xMC41NjdsMTg1Ljg2NS0xODYuMTQ2YzcuMDQzLTcuMDQzLDEwLjU2Ny0xNS42MDgsMTAuNTY3LTI1LjY5OCAgIEM0NDQuODE5LDIwMS44MDUsNDQxLjI5NSwxOTMuMTQ1LDQzNC4yNTIsMTg1LjcyMXoiIGZpbGw9IiMwMDAwMDAiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K" />
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    var name = prompt("暱稱 : ","noob");
    var chatform=document.getElementById("chat-form");
    var chatinput=document.getElementById("chat-input");
    var upImg = document.getElementById("upimg");
    var downImg = document.getElementById("downimg");
    var leftImg = document.getElementById("leftimg");
    var rightImg = document.getElementById("rightimg");
    var par=document.getElementById("par");
    var c = document.getElementById("ctx");
    var canvasPosition = c.getBoundingClientRect();
    var ctx = c.getContext("2d");
    var socket=io();
    var ctxHeight=500;
    var ctxWidth=1000;
    var tankHeight=20;
    var tankWidth=20;
    var bulletHeight=3;
    var bulletWidth=3;
    window.addEventListener('keydown',this.keyFunction,false);
    window.addEventListener('keyup',this.keyUpFunction,false);
    
    par.innerText=name;

    if(name == "" || name == null){
        name="noob";
    }
    socket.emit("addUser",encodeURIComponent(name));

    socket.on('new positions',function(data){
        ctx.clearRect(0,0,ctxWidth,ctxHeight);
        ctx.fillStyle="#CCCCCC";
        ctx.fillRect(900,400,100,100);
        ctx.fillStyle = "#00AAFF";
        for(var i = 0; i < data.tankinfo.length; i++){
            if(data.tankinfo[i].die==false){
                ctx.fillStyle = data.tankinfo[i].color;
                ctx.fillRect(data.tankinfo[i].x,data.tankinfo[i].y,tankHeight,tankWidth);
                ctx.fillStyle="#000000";
                ctx.font="7px Verdana";
                ctx.fillText(decodeURIComponent(data.tankinfo[i].nickname),data.tankinfo[i].x,data.tankinfo[i].y + tankHeight +10);
                ctx.fillText(decodeURIComponent(data.tankinfo[i].msg),data.tankinfo[i].x,data.tankinfo[i].y -20);
                ctx.fillStyle="#FF0000";
                ctx.font="15px Verdana";
                ctx.fillText("safezone",925,420);
                ctx.beginPath();
                ctx.moveTo(data.tankinfo[i].x,data.tankinfo[i].y-5);
                ctx.lineTo(data.tankinfo[i].x+(data.tankinfo[i].hp)*2,data.tankinfo[i].y-5);
                ctx.strokeStyle="#FF0000";
                ctx.lineWidth=2;
                ctx.stroke(); 
                ctx.beginPath();
                ctx.moveTo(data.tankinfo[i].x+tankWidth/2,data.tankinfo[i].y+tankHeight/2);
                ctx.lineTo(data.tankinfo[i].barrelx,data.tankinfo[i].barrely);
                ctx.strokeStyle="#777777";
                ctx.lineWidth=5;
                ctx.stroke(); 
            }
        }
        ctx.fillStyle = "#FF0000";
        for(var i=0; i<data.bulletinfo.length;i++){
             ctx.fillRect(data.bulletinfo[i].x,data.bulletinfo[i].y,bulletHeight,bulletWidth);
        }
        ctx.fillStyle="#555555";
       
    });
    socket.on('lose',function(){
        //alert("you die");
        par.innerText="you lose refresh to play again";
    });

    socket.on('yourPoint',function(data){
        //alert("you die");
        par.innerText=data.point.toString();
    });

    document.onkeydown = function(event) {
        var code=event.keyCode;
        switch (code) {
        case 65:
            socket.emit('keyPress',{inputId:"left",state:true});
            break;
        case 87:
            socket.emit('keyPress',{inputId:"up",state:true});
            break;
        case 68:
            socket.emit('keyPress',{inputId:"right",state:true});
            break;
        case 83:
            socket.emit('keyPress',{inputId:"down",state:true});
            break;
        case 32:
            socket.emit('keyPress',{inputId:"space",state:true});
            break;
        case 90:
            socket.emit('keyPress',{inputId:"health",state:true});
            break;
        }
    }

    document.onkeyup = function(event) {
        var code=event.keyCode;
        switch (code) {
        case 65:
            socket.emit('keyPress',{inputId:"left",state:false});
            break;
        case 87:
            socket.emit('keyPress',{inputId:"up",state:false});
            break;
        case 68:
            socket.emit('keyPress',{inputId:"right",state:false});
            break;
        case 83:
            socket.emit('keyPress',{inputId:"down",state:false});
            break;
        case 32:
            socket.emit('keyPress',{inputId:"space",state:false});
            break;    
    }
    
    }


    chatform.onsubmit = function(e){
        e.preventDefault();
        socket.emit("sendMsg",chatinput.value);
        chatinput.value="";

    }

    upImg.ontouchstart = function(event){
        socket.emit('keyPress',{inputId:"up",state:true});
    }
    upImg.ontouchend = function(event){
        socket.emit('keyPress',{inputId:"up",state:false});
    }
    downImg.ontouchstart = function(event){
        socket.emit('keyPress',{inputId:"down",state:true});
    }
    downImg.ontouchend = function(event){
        socket.emit('keyPress',{inputId:"down",state:false});
    }
         leftImg.ontouchstart = function(event){
        socket.emit('keyPress',{inputId:"left",state:true});
    }
    leftImg.ontouchend = function(event){
        socket.emit('keyPress',{inputId:"left",state:false});
    }
         rightImg.ontouchstart = function(event){
        socket.emit('keyPress',{inputId:"right",state:true});
    }
    rightImg.ontouchend = function(event){
        socket.emit('keyPress',{inputId:"right",state:false});
    }
   c.onclick = function(event){
       socket.emit('mouseClick',{state:true});
   }

    function mouseFunction(event){
        var x = event.clientX-canvasPosition.left;
        var y = event.clientY-canvasPosition.top;
        socket.emit('mousePosition',{mouseX:x,mouseY:y});
    }

</script>
</body>
</html>