<!DOCTYPE html>
<html>
<head>
	<title>快速打字練習</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="assets/css/btn1.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
</head>
<body>

</body>
</html>
<script type="text/javascript">
	const word_list =[];
	var Game_Times = 0;
	var Game_T = 0;
	var Game_F = 0;
	var start_time ;
	var end_time ;
	var round_time = 0
	Main_action= new function()
	{
		//	create UI
		Control_UI();
		//	event
		Listener_Event();
	}
	function Control_UI()
	{
		var top_frame = document.createElement("div");
		var center_frame = document.createElement("div");
		var bottom_frame = document.createElement("div");

		// set id
		top_frame.id = "top_frame";
		center_frame.id="center_frame";
		bottom_frame.id="bottom_frame";

		document.body.appendChild(top_frame);
		document.body.appendChild(center_frame);
		document.body.appendChild(bottom_frame);

		draw_UI();
	}
	function draw_UI()
	{
		//	voice
		document.getElementById("top_frame").innerHTML="<div><span id='voice_frame'><img src='assets/images/voice.png' width='5%' height='5%' id='voice'></span><span><img src='assets/images/popo_score.jpg' width='5%' height='5%' id='score'></span></div><div id='score_frame'><div id='score_list'></div></div>";
		//  title
		document.getElementById("center_frame").innerHTML = "<div id='popo_start'><div id='popo_title'>快速 pp train</div></div>";
		document.getElementById("bottom_frame").innerHTML = "<div class='btnstyle' id='start'>Start</div><div class='btnstyle' id='rule'>Rule</div>";
	}
	function Listener_Event()
	{
		var speed = 200;
		var addrule;
		var string;
		$('#start').click(function()
			{
				$('#start').fadeOut(speed,function(){$('#start').remove();});
				$('#rule').fadeOut(speed,function(){$('#rule').remove();});
				$('#popo_title').fadeOut(speed,function(){$('#popo_title').remove();});
				$('#popo_start').fadeOut(speed,function(){$('#popo_start').remove();});
				Game_join();
			});
		$('#rule').click(function()
			{
				addrule = document.createElement('div');
				addrule.id = 'addrule';
				document.body.appendChild(addrule);
				document.getElementById('addrule').innerHTML="<div style='display:none' id='ruletxt'>說明與規則<br><br>這是一款英打練習，讓您熟悉鍵盤上的每個按鍵<br><button class='backbtn'>return</button></div>";
				$("#start").hide(speed,function()
					{
						$('#ruletxt').fadeIn(2*speed);
					});
				$('.backbtn').click(function()
				{
					
					$('#ruletxt').fadeOut(speed,function()
						{
							$('#ruletxt').remove(ruletxt);
						});
					$('#start').show(speed);
				});
			});
		score.onmouseover = ()=>
		{
			score_list.style.marginLeft = "0%";
			score_list.style.transition = "1s";
			score_list.onmouseover = ()=>
			{
				score_list.style.marginLeft = "0%";
				score_list.style.transition = "1s";
			}
			score_list.onmouseout = ()=>
			{
				score_list.style.marginLeft = "300%";
				score_list.style.transition = '3s';
			}
		}
		score.onmouseout = ()=>
		{
			score_list.style.marginLeft = "300%";
			score_list.style.transition = '3s';
		}
	}
	function Game_join()
	{
		Game_Build_List();
		Game_Control_UI();
	}
	function Game_Control_UI()
	{
		
		Game_draw_UI();
		Game_Listener_Event();
	}
	function middle_draw()
	{
		string="";
		string+="<table width='60%' height='50%' id='middle_table'>";
		for(var i = 1 ; i<=10;i++)
		{
			string+="<tr>";
			for(var j = 1;j<=3 ; j++)
			{
				string+="<td>|</td>"
			}
			string+="</tr>";
		}
		string+="</table>";
		
		return document.getElementById("middle_screen").innerHTML= string;

	}
	function Question_draw()
	{
		string="";
		string+=Random_string();
		start_time = Date.now();
		return document.getElementById('question_screen').innerHTML=string;
	}
	function Game_draw_UI()
	{

		document.getElementById("center_frame").innerHTML = "<div id='question_screen'></div><div id='middle_screen'></div>";
		document.getElementById("bottom_frame").innerHTML = "<dir id='bottom_txtbtn'><input id='answer' type='text'><br><input type='button' class='btnstyle' style='background:#666666;border-radius: 5px;' onclick='Game_send()' value='送出' id='Game_send'><input type='button' onclick='Question_draw()' style='background:#666666;border-radius: 5px;' class='btnstyle' value='重設'></dir>";
		middle_draw();
		Question_draw();

	}
	function Random_string()
	{
		var question = "";
		num = Math.floor(Math.random()*12+3);
		for(var i = 0;i<num;i++)
			{
				random = Math.floor(Math.random()*62);
				question += word_list[random];
			}
		return question;
	}
	function Game_Build_List()
	{
		for(var i = 0 ;i<26;i++)word_list[i]=String.fromCharCode(65+i);
		for(var j= 0;j<26;j++)word_list[j+26] = String.fromCharCode(97+j);
		for(var k = 0;k<=9;k++)word_list[k+52] = k;
	}
	function Game_Listener_Event()
	{
		var txtinput,question_txt;
		$('#answer').keydown((event)=>
		{
			if(event.which == 13)$('#Game_send').click();
		});
	}
	//	send answer
	function Game_send()
	{
		txtinput = $('#answer').val();
		question_txt = $('#question_screen').text();
		end_time = Date.now();
		if(txtinput == question_txt)Middle_TF(true);
		else Middle_TF(false);
		$('#answer').val("");
		$('#question_screen').fadeOut(100,function()
			{
				Question_draw();
				$('#question_screen').fadeIn(100);
			});

	}
	function Middle_TF(TF)
	{
		round_time += ((end_time - start_time)/1000)
		if(TF)
			{
				document.getElementById('middle_table').rows[parseInt(Game_Times%10)].cells[parseInt(Game_Times/10)].innerHTML="O";
				Game_T+=1;
				document.getElementById('score_list').innerHTML +="<div id='score_type'><pre>"+(Game_Times+1)+"\t: "+((end_time - start_time)/1000)+" 秒</pre></div>";
			}
		else 
			{
				document.getElementById('middle_table').rows[parseInt(Game_Times%10)].cells[parseInt(Game_Times/10)].innerHTML="X";
				Game_F+=1;
				document.getElementById('score_list').innerHTML+="<div id='score_type'><pre>"+(Game_Times+1)+"\t: "+((end_time - start_time)/1000)+" 秒</pre></div>";
			}

		Game_Times+=1;
		if(Game_Times>29)
		{
			alert("正確: "+Game_T+",錯誤: "+Game_F+" 使用時間: "+round_time+"秒" + ", 平均時間: "+round_time/30);
			Game_T = 0;
			Game_F = 0;
			Game_Times = 0
			round_time = 0
			middle_draw();
			document.getElementById('score_list').innerHTML = "";
		}
	}
</script>